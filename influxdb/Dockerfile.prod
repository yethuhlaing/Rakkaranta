FROM influxdb:latest

# For Azure App Service compatibility
ENV PORT=8086

# Create directories for persistence
# Azure App Service provides persistent storage at /home
RUN mkdir -p /home/influxdb2/data /home/influxdb2/config
RUN ln -s /home/influxdb2/data /var/lib/influxdb2
RUN ln -s /home/influxdb2/config /etc/influxdb2

# Add startup script
COPY init.sh /init.sh
RUN chmod +x /init.sh

# Expose InfluxDB API port
EXPOSE 8086

# Start InfluxDB with the startup script
CMD ["/init.sh"]